<?xml version="1.0" encoding="utf-8"?>
<section id="stream_process_command">
  <title>stream command</title>
  <simplesect role="usage" id="gen-000">
    <title>Usage</title>
    <para>
      <literal>stream 
         [ --input-file|:f <ulink url="s_filename.html">filename</ulink> |
	   --input-pipe|:p <ulink url="s_filename.html">filename</ulink> |
           --input-string|:s <ulink url="s_exp.html">expression</ulink>]
	 [ --output-file|:F <ulink url="s_filename.html">filename</ulink> |
           --output-pipe|:P <ulink url="s_filename.html">filename</ulink> |
           --output-string|:S <ulink url="s_varname.html">$variable</ulink> |
           --no-output|:N ]
           select <ulink url="s_xpath.html">xpath</ulink> <ulink url="s_block.html">block</ulink>
         [ select <ulink url="s_xpath.html">xpath</ulink> <ulink url="s_block.html">block</ulink> ... ]
                   </literal>
    </para>
  </simplesect>
  <simplesect role="description" id="gen-001"><title>Description</title>
	  <para>
	    EXPERIMENTAL!  This command provides a memory efficient
	    (though slower) way to process selected parts of an XML
	    document with XSH2. A streaming XML parser (SAX parser) is
	    used to parse the input. The parser has two states which
	    will be referred to as A and B below. The initial state of
	    the parser is A.</para> <para>In the state A, only a
	    limited vertical portion of the DOM tree is built. All XML
	    data coming from the input stream other than start-tags
	    are immediately copied to the output stream.  If a new
	    start-tag of an element arrives, a new node is created in
	    the tree. All siblings of the newly created node are
	    removed. Thus, in the state A, there is exactly one node
	    on every level of the tree. After a node is added to the
	    tree, all the <ulink url="s_xpath.html">xpath</ulink> expressions
	    following the <literal>select</literal> keyword
	    are
	    checked. If none matches, the parser remains in state A
	    and copies the start-tag to the output stream. Otherwise,
	    the first expression that matches is remembered and the
	    parser changes its state to B.
	  </para>
	  <para>
	    In state B the parser builds a complete DOM subtree of the
	    element that was last added to the tree before the parser
	    changed its state from A to B. No data are sent to the
	    output at this stage. When the subtree is complete
	    (i.e. the corresponding end-tag for its topmost element is
	    encountered), the <ulink url="s_block.html">block</ulink> of instructions
	    following the <ulink url="s_xpath.html">xpath</ulink> expression that
	    matched is invoked with the root element of the subtree as
	    the current context node. The commands in <ulink url="s_block.html">block</ulink> are allowed to transform the whole
	    element subtree or even to replace it with a different DOM
	    subtree or subtrees. They must, however, leave intact 
	    all ancestor nodes of the subtree. 
            Failing to do so can result in an error or
	    unpredictable results.
	  </para>
	  <para>
	    After the subtree processing <ulink url="s_block.html">block</ulink>
	    returns, all subtrees that now appear in the DOM tree in
	    the place of the original subtree are serialized to the
	    output stream. After that, they are deleted and the parser
	    returns to state A.
	  </para>
	  <para>
	    Note that this type of processing highly limits the amount
	    of information the selecting XPath expressions can use. The first
	    notable fact is, that elements can not be selected by their
	    content. The only information present in the tree at the
	    time of the XPath evaluation is the element's name and
	    attributes plus the same information for all its
	    ancestors (there is no information at all about its possible
	    child nodes nor of the node's position
	    within the list of its siblings).
	  </para>
	  <para>The input parameters below are mutually exclusive.
	  If non is given, standard input is processed.</para>
	  <para><literal>--input-file</literal> or <literal>:f</literal>
	    instructs the processor to stream from a given file.</para>
	  <para><literal>--input-pipe</literal> or <literal>:p</literal>
	    instructs the processor to stream the output of a given a command.</para>
	  <para><literal>--input-string</literal> or <literal>:s</literal>
	    instructs the processor to use the result of a given
	    expression as the input to be processed.
	  </para>
	  <para>The output parameters below are mutually exclusive.
	    If none is given, standard output is used.
	  </para>
	  <para><literal>--output-file</literal> or <literal>:F</literal>
	    instructs the processor to save the output
	    to a given file.</para>
	  <para><literal>--output-pipe</literal> or <literal>:P</literal>
	    instructs the processor to pipe the output
	    to a given command.
	  </para>
	  <para><literal>--output-string</literal> or <literal>:S</literal>
	    followed by a variable name instructs the processor to 
	    store the result in the given variable.
	  </para>
	  <para><literal>--no-output</literal> or <literal>:N</literal>
            instructs the processor to throw the result away.
	  </para>
	</simplesect>
  <simplesect id="gen-002">
    <title>Sections</title>
    <para><ulink url="s_Flow.html">Flow control</ulink>, <ulink url="s_Documents.html">Files/Documents</ulink></para>
  </simplesect>
</section>
