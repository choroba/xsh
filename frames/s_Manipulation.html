<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Tree modification</title>
<link rel="stylesheet" type="text/css" href="style.css">
<meta name="generator" content="DocBook XSL Stylesheets Vsnapshot">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section">
<div class="titlepage">
<div><div><h2 class="title" style="clear: both">
<a name="Manipulation" target="_self"></a>Tree modification</h2></div></div>
<hr>
</div>
<p>
	XSH2 not only provides ways to browse and inspect the DOM tree but also
	many commands to modify its content by various operations,
	such as copying,
	moving, and deleting its nodes as well as creating completely new nodes
	or XML fragments and attaching them to it. It is quite easy to learn
	these commands since their names or aliases mimic their well-known
	filesystem analogies.  On the other hand, many of these commands have
	two versions one of which is prefixed with a letter "x". This
	"x" stands for "cross", thus e.g. <a class="ulink" href="s_xcopy_command.html" target="_self">xcopy</a> should be read as "cross copy".
	Let's explain the difference on the example of <a class="ulink" href="s_xcopy_command.html" target="_self">xcopy</a>.</p>
<p>
	In a copy operation, you have to specify what nodes are to be
	copied and where to, in other words, you have to specify the
	<span class="emphasis"><em>source</em></span> and the
	<span class="emphasis"><em>target</em></span>.  XSH2 is very much XPath-based so,
	XPath is used here to specify both of them. However, there
	might be more than one node that satisfies an XPath expression. So,
	the rule of thumb is that the "cross" variant of a
	command places <span class="emphasis"><em>one and every</em></span> of the source nodes
	to the location of <span class="emphasis"><em>one and every</em></span> destination
	node, while the plain variant works one-by-one, placing the
	first source node to the first destination, the second source
	node to the second destination, and so on (as long as there
	are both source nodes and destinations left).
      </p>
<div class="example">
<a name="gen-000" target="_self"></a><p class="title"><b>Example&nbsp;1.&nbsp;</b></p>
<div class="example-contents"><pre class="programlisting">$scratch/&gt; <strong class="userinput"><code>$a := create "&lt;X&gt;&lt;A/&gt;&lt;Y/&gt;&lt;A/&gt;&lt;/X&gt;";</code></strong>
$a/&gt; <strong class="userinput"><code>$b := create "&lt;X&gt;&lt;B/&gt;&lt;C/&gt;&lt;B/&gt;&lt;C/&gt;&lt;B/&gt;&lt;/X&gt;";</code></strong>
$b/&gt; <strong class="userinput"><code>xcopy $a//A replace $b//B;</code></strong>
$b/&gt; <strong class="userinput"><code>copy $b//C before $a//A;</code></strong>
$b/&gt; <strong class="userinput"><code>ls $a;</code></strong>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;X&gt;&lt;C/&gt;&lt;A/&gt;&lt;Y/&gt;&lt;C/&gt;&lt;A/&gt;&lt;/X&gt;

$b/&gt; <strong class="userinput"><code>ls $b;</code></strong>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;X&gt;&lt;A/&gt;&lt;A/&gt;&lt;C/&gt;&lt;A/&gt;&lt;A/&gt;&lt;C/&gt;&lt;A/&gt;&lt;A/&gt;&lt;/X&gt;
</pre></div>
</div>
<br class="example-break"><p>
	As already indicated by the example, another issue of tree modification
	is the way in which the destination node determines the target
	location. Should the source node be placed before, after, or somewhere
	among the children of the resulting node? Or maybe, should it replace
	it completely? This information has to be given in the
	<a class="ulink" href="s_loc.html" target="_self">location</a> argument that usually precedes the destination
	XPath.
      </p>
<p>
	Now, what happens if source and destination nodes are of
	incompatible types? XSH2 tries to avoid this by implicitly
	converting between node types when necessary.  For example, if
	a text, comment, and attribute node is copied into, before or
	after an attribute node, the original value of the
	attribute is replaced, prepended or appended respectively with
	the textual content of the source node. Note however, that
	<span class="emphasis"><em>element nodes are never converted</em></span> into
	text, attribute or any other textual node.  There
	are many combinations here, so try yourself and see the
	results.
      </p>
<p>You may even use some more sophisticated way to convert
	between node types, as shown in the following example, where
	an element is first commented out and than again uncommented.
	Note, that the particular approach used for resurrecting the
	commented XML material works only for well-balanced chunks of
	XML.
      </p>
<div class="example">
<a name="gen-001" target="_self"></a><p class="title"><b>Example&nbsp;2.&nbsp;Using string variables to convert between different
	  types of nodes</b></p>
<div class="example-contents"><pre class="programlisting"><strong class="userinput"><code>$doc := create &lt;&lt;EOF;
&lt;?xml version='1.0'?&gt;
&lt;book&gt;
  &lt;chapter&gt;
    &lt;title&gt;Intro&lt;/title&gt;
  &lt;/chapter&gt;
  &lt;chapter&gt;
    &lt;title&gt;Rest&lt;/title&gt;
  &lt;/chapter&gt;
&lt;/book&gt;
EOF
</code></strong>

# comment out the first chapter
<strong class="userinput"><code>ls //chapter[1] |&gt; $chapter_xml;</code></strong>
<strong class="userinput"><code>insert comment $chapter_xml replace //chapter[1];</code></strong>
<strong class="userinput"><code>ls / 0;</code></strong>
# OUTPUT:
&lt;?xml version="1.0"?&gt;
&lt;book&gt;
&lt;!--  &lt;chapter&gt;
    &lt;title&gt;Intro&lt;/title&gt;
  &lt;/chapter&gt;
--&gt;
  &lt;chapter&gt;
    &lt;title&gt;Rest&lt;/title&gt;
  &lt;/chapter&gt;
&lt;/book&gt;


# un-comment the chapter
<strong class="userinput"><code>$comment = string(//comment()[1]);</code></strong>
<strong class="userinput"><code>insert chunk $comment replace //comment()[1];</code></strong>
<strong class="userinput"><code>ls / 0;</code></strong>
# OUTPUT:
&lt;?xml version="1.0"?&gt;
&lt;book&gt;
  &lt;chapter&gt;
    &lt;title&gt;Intro&lt;/title&gt;
  &lt;/chapter&gt;

  &lt;chapter&gt;
    &lt;title&gt;Rest&lt;/title&gt;
  &lt;/chapter&gt;
&lt;/book&gt;
</pre></div>
</div>
<br class="example-break"><div class="simplesect">
<div class="titlepage"><div><div><h3 class="title">
<a name="gen-002" target="_self"></a>Related Topics</h3></div></div></div>
<div class="variablelist"><dl class="variablelist">
<dt><span class="term"><a class="ulink" href="s_change_namespace_prefix_command.html" target="_self">change-ns-prefix</a></span></dt>
<dd>change namespace prefix (EXPERIMENTAL)</dd>
<dt><span class="term"><a class="ulink" href="s_change_namespace_uri_command.html" target="_self">change-ns-uri</a></span></dt>
<dd>change namespace URI (EXPERIMENTAL)</dd>
<dt><span class="term"><a class="ulink" href="s_clone_command.html" target="_self">clone</a></span></dt>
<dd>clone a given document</dd>
<dt><span class="term"><a class="ulink" href="s_copy_command.html" target="_self">copy</a></span></dt>
<dd>copy nodes (in the one-to-one mode)</dd>
<dt><span class="term"><a class="ulink" href="s_declare_namespace_command.html" target="_self">declare-ns</a></span></dt>
<dd>create a special attribute declaring an XML namespace (EXPERIMENTAL)</dd>
<dt><span class="term"><a class="ulink" href="s_edit_command.html" target="_self">edit</a></span></dt>
<dd>Edit parts of a XML document in a text editor.</dd>
<dt><span class="term"><a class="ulink" href="s_edit_string_command.html" target="_self">edit-string</a></span></dt>
<dd>Edit a string or variable in a text editor.</dd>
<dt><span class="term"><a class="ulink" href="s_exp.html" target="_self">expression</a></span></dt>
<dd>expression argument type</dd>
<dt><span class="term"><a class="ulink" href="s_hash_command.html" target="_self">hash</a></span></dt>
<dd>index selected nodes by some key value</dd>
<dt><span class="term"><a class="ulink" href="s_insert_command.html" target="_self">insert</a></span></dt>
<dd>create a node in on a given target location</dd>
<dt><span class="term"><a class="ulink" href="s_loc.html" target="_self">location</a></span></dt>
<dd>relative destination specification (such as after, before, etc.)</dd>
<dt><span class="term"><a class="ulink" href="s_map_command.html" target="_self">map</a></span></dt>
<dd>transform node value/data using Perl or XPath expression</dd>
<dt><span class="term"><a class="ulink" href="s_move_command.html" target="_self">move</a></span></dt>
<dd>move nodes (in the one-to-one mode)</dd>
<dt><span class="term"><a class="ulink" href="s_nodetype.html" target="_self">node-type</a></span></dt>
<dd>node type specification (such as element, attribute, etc.)</dd>
<dt><span class="term"><a class="ulink" href="s_normalize_command.html" target="_self">normalize</a></span></dt>
<dd>normalizes adjacent textnodes</dd>
<dt><span class="term"><a class="ulink" href="s_process_xinclude_command.html" target="_self">process-xinclude</a></span></dt>
<dd>load and insert XInclude sections</dd>
<dt><span class="term"><a class="ulink" href="s_prune_command.html" target="_self">remove</a></span></dt>
<dd>remove given nodes</dd>
<dt><span class="term"><a class="ulink" href="s_rename_command.html" target="_self">rename</a></span></dt>
<dd>quickly rename nodes with in-line Perl code</dd>
<dt><span class="term"><a class="ulink" href="s_set_command.html" target="_self">set</a></span></dt>
<dd>create or modify document content (EXPERIMENTAL)</dd>
<dt><span class="term"><a class="ulink" href="s_set_dtd_command.html" target="_self">set-dtd</a></span></dt>
<dd>set document's DTD declaration</dd>
<dt><span class="term"><a class="ulink" href="s_set_enc_command.html" target="_self">set-enc</a></span></dt>
<dd>set document's charset (encoding)</dd>
<dt><span class="term"><a class="ulink" href="s_set_namespace_command.html" target="_self">set-ns</a></span></dt>
<dd>set namespace of the current node (EXPERIMENTAL)</dd>
<dt><span class="term"><a class="ulink" href="s_set_standalone_command.html" target="_self">set-standalone</a></span></dt>
<dd>set document's standalone flag</dd>
<dt><span class="term"><a class="ulink" href="s_sort_command.html" target="_self">sort</a></span></dt>
<dd>sort a given node-list by given criteria</dd>
<dt><span class="term"><a class="ulink" href="s_strip_ws_command.html" target="_self">strip-whitespace</a></span></dt>
<dd>strip leading and trailing whitespace</dd>
<dt><span class="term"><a class="ulink" href="s_wrap_command.html" target="_self">wrap</a></span></dt>
<dd>wrap given nodes into elements</dd>
<dt><span class="term"><a class="ulink" href="s_wrap_span_command.html" target="_self">wrap-span</a></span></dt>
<dd>wrap spans of nodes into elements</dd>
<dt><span class="term"><a class="ulink" href="s_xcopy_command.html" target="_self">xcopy</a></span></dt>
<dd>copy nodes (in the all-to-every mode)</dd>
<dt><span class="term"><a class="ulink" href="s_xinsert_command.html" target="_self">xinsert</a></span></dt>
<dd>create nodes on all target locations</dd>
<dt><span class="term"><a class="ulink" href="s_xmove_command.html" target="_self">xmove</a></span></dt>
<dd>move nodes (in the all-to-every mode)</dd>
<dt><span class="term"><a class="ulink" href="s_xpath.html" target="_self">xpath</a></span></dt>
<dd>XPath expression</dd>
<dt><span class="term"><a class="ulink" href="s_xslt_command.html" target="_self">xslt</a></span></dt>
<dd>compile a XSLT stylesheet and/or transform a document with XSLT</dd>
<dt><span class="term"><a class="ulink" href="s_xupdate_command.html" target="_self">xupdate</a></span></dt>
<dd>apply XUpdate commands on a document</dd>
</dl></div>
</div>
</div></body>
</html>
